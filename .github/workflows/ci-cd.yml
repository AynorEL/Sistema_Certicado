name: FTP Deploy - Solo PHP Modificados

on:
  push:
    branches:
      - main

jobs:
  deploy-php-changes:
    name: Subir solo archivos PHP modificados por FTP
    runs-on: ubuntu-latest

    steps:
      - name: Checkout del repositorio
        uses: actions/checkout@v4

      - name: Obtener archivos PHP modificados
        id: get_changes
        run: |
          echo "üìÇ Obteniendo archivos PHP modificados..."
          git fetch origin main --depth=2
          ARCHIVOS=$(git diff --name-only HEAD~1 HEAD | grep '\.php$' || true)
          echo "MODIFICADOS<<EOF" >> $GITHUB_ENV
          echo "$ARCHIVOS" >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV
          echo "$ARCHIVOS"

      - name: Mostrar archivos detectados
        run: |
          echo "üìù Archivos PHP modificados:"
          echo "${{ env.MODIFICADOS }}"

      - name: Subir archivos modificados por FTP
        if: env.MODIFICADOS != ''
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          local-dir: ./
          server-dir: ${{ secrets.FTP_TARGET_DIR }}
          exclude: |
            **/*
          include: |
            ${{ env.MODIFICADOS }}

      - name: Finalizaci√≥n
        if: env.MODIFICADOS == ''
        run: echo "‚úÖ No hay archivos PHP modificados. No se despliega nada."
